<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <title>N-Queen: All Yellow Backtracking</title>
        <style>
            :root {
                --cell-size: 60px;
                --node-size: 32px;
                --accent: #f1c40f; /* íƒìƒ‰ ì¤‘ì¸ ë…¸ë€ìƒ‰ */
                --success: #2ecc71; /* ì •ë‹µ ì´ˆë¡ìƒ‰ */
                --path-hide: 0.05; /* ì‹¤íŒ¨í•œ ê²½ë¡œ (ê±°ì˜ ì•ˆë³´ì„) */
            }
            body {
                font-family: "Pretendard", sans-serif;
                background: #121212;
                color: white;
                display: flex;
                flex-direction: column;
                align-items: center;
                margin: 0;
                padding: 20px;
                overflow-x: hidden;
            }
            .container {
                display: flex;
                gap: 40px;
                justify-content: center;
                width: 100%;
                max-width: 1200px;
            }

            #board {
                display: grid;
                grid-template-columns: repeat(4, var(--cell-size));
                border: 4px solid #444;
                background: #444;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            }
            .cell {
                width: var(--cell-size);
                height: var(--cell-size);
                display: flex;
                justify-content: center;
                align-items: center;
                font-size: 35px;
            }
            .white {
                background: #eeeed2;
                color: #333;
            }
            .black {
                background: #769656;
                color: #333;
            }

            #tree-area {
                flex-grow: 1;
                height: 600px;
                position: relative;
                background: #1e1e1e;
                border-radius: 15px;
                border: 1px solid #333;
                overflow: hidden;
            }
            .node {
                position: absolute;
                width: var(--node-size);
                height: var(--node-size);
                background: #333;
                border-radius: 50%;
                display: flex;
                justify-content: center;
                align-items: center;
                font-size: 14px;
                font-weight: bold;
                transition: all 0.3s ease;
                z-index: 2;
                border: 2px solid #555;
            }
            /* í˜„ì¬ íƒìƒ‰ ë° ì„ íƒëœ ê²½ë¡œëŠ” ëª¨ë‘ ë…¸ë€ìƒ‰ */
            .node.active,
            .node.placed {
                background: var(--accent) !important;
                color: #000;
                border-color: #fff;
                box-shadow: 0 0 15px var(--accent);
                transform: scale(1.15);
            }
            .node.success {
                background: var(--success) !important;
                box-shadow: 0 0 20px var(--success);
                transform: scale(1.2);
                color: #fff;
            }
            .node.faded {
                opacity: var(--path-hide);
                filter: grayscale(1);
            }

            line {
                stroke: #444;
                stroke-width: 2;
                transition: all 0.3s;
            }
            line.active {
                stroke: var(--accent);
                stroke-width: 4;
            }
            line.success {
                stroke: var(--success);
                stroke-width: 3;
                opacity: 1 !important;
            }
            line.faded {
                opacity: var(--path-hide);
            }

            .controls {
                margin-top: 30px;
                text-align: center;
            }
            button {
                padding: 15px 40px;
                font-size: 18px;
                cursor: pointer;
                border-radius: 30px;
                border: none;
                background: var(--accent);
                color: black;
                font-weight: bold;
                transition: 0.2s;
            }
            button:hover {
                transform: scale(1.05);
                background: #f39c12;
            }
            #status {
                font-size: 1.3rem;
                height: 1.5em;
                color: var(--accent);
                margin-bottom: 10px;
                font-weight: bold;
            }
        </style>
    </head>
    <body>
        <div id="status">íƒìƒ‰ ì‹œì‘ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</div>

        <div class="container">
            <div id="board-container">
                <div id="board"></div>
            </div>
            <div id="tree-area">
                <svg id="tree-svg" width="100%" height="100%"></svg>
            </div>
        </div>

        <div class="controls">
            <button onclick="start()">íƒìƒ‰ ì‹œì‘</button>
        </div>

        <script>
            const N = 4;
            let solutions = 0;
            const boardElem = document.getElementById("board");
            const treeArea = document.getElementById("tree-area");
            const svgElem = document.getElementById("tree-svg");
            const statusElem = document.getElementById("status");

            let col = new Array(N).fill(false);
            let d1 = new Array(2 * N).fill(false);
            let d2 = new Array(2 * N).fill(false);

            function init() {
                solutions = 0;
                boardElem.innerHTML = "";
                svgElem.innerHTML = "";
                document.querySelectorAll(".node").forEach((n) => n.remove());

                for (let y = 0; y < N; y++) {
                    for (let x = 0; x < N; x++) {
                        const cell = document.createElement("div");
                        cell.className = `cell ${
                            (y + x) % 2 === 0 ? "white" : "black"
                        }`;
                        cell.id = `c-${y}-${x}`;
                        boardElem.appendChild(cell);
                    }
                }
                createNode("root", treeArea.clientWidth / 2, 40, "R");
            }

            function createNode(id, x, y, label, pX, pY) {
                if (pX !== undefined) {
                    const line = document.createElementNS(
                        "http://www.w3.org/2000/svg",
                        "line"
                    );
                    line.setAttribute("x1", pX);
                    line.setAttribute("y1", pY);
                    line.setAttribute("x2", x);
                    line.setAttribute("y2", y);
                    line.id = `l-${id}`;
                    svgElem.appendChild(line);
                }
                const div = document.createElement("div");
                div.className = "node";
                div.id = `n-${id}`;
                div.style.left = `${x - 16}px`;
                div.style.top = `${y - 16}px`;
                div.innerText = label;
                treeArea.appendChild(div);
            }

            const sleep = (ms) => new Promise((res) => setTimeout(res, ms));

            async function solve(y, pX, pY, pId) {
                if (y === N) {
                    solutions++;
                    statusElem.innerText = `ğŸŠ ${solutions}ë²ˆì§¸ ì •ë‹µ ë°œê²¬!`;
                    highlightPath(pId);
                    await sleep(1200);
                    return;
                }

                const width = treeArea.clientWidth;
                const xGap = width / Math.pow(N, y + 1.15);
                const startX = pX - (xGap * (N - 1)) / 2;

                for (let x = 0; x < N; x++) {
                    const curX = startX + x * xGap;
                    const curY = pY + 110;
                    const curId = `${pId}-${x}`;

                    createNode(curId, curX, curY, x, pX, pY);
                    const node = document.getElementById(`n-${curId}`);
                    const line = document.getElementById(`l-${curId}`);
                    const cell = document.getElementById(`c-${y}-${x}`);

                    node.classList.add("active");
                    if (line) line.classList.add("active");
                    cell.style.boxShadow = "inset 0 0 20px #f1c40f";

                    await sleep(350);

                    if (!col[x] && !d1[y - x + N] && !d2[y + x]) {
                        cell.innerText = "â™›";
                        cell.style.boxShadow = "";
                        node.classList.add("placed");

                        col[x] = d1[y - x + N] = d2[y + x] = true;
                        await solve(y + 1, curX, curY, curId);

                        // ë°±íŠ¸ë˜í‚¹ (ê³µí†µ)
                        cell.innerText = "";
                        if (!node.classList.contains("success")) {
                            node.classList.add("faded");
                            if (line) line.classList.add("faded");
                        }
                        col[x] = d1[y - x + N] = d2[y + x] = false;
                    } else {
                        node.classList.add("faded");
                        if (line) line.classList.add("faded");
                        cell.style.boxShadow = "";
                    }

                    if (line) line.classList.remove("active");
                    await sleep(150);
                }
            }

            function highlightPath(id) {
                const parts = id.split("-");
                let current = "";
                parts.forEach((p) => {
                    current = current === "" ? p : `${current}-${p}`;
                    const n = document.getElementById(`n-${current}`);
                    const l = document.getElementById(`l-${current}`);
                    if (n) n.classList.add("success");
                    if (l) l.classList.add("success");
                });
            }

            async function start() {
                init();
                col.fill(false);
                d1.fill(false);
                d2.fill(false);
                await solve(0, treeArea.clientWidth / 2, 40, "root");
                statusElem.innerText = `âœ… ì¢…ë£Œ! ì´ ${solutions}ê°œì˜ í•´ë‹µ ë°œê²¬`;
            }

            window.onload = init;
        </script>
    </body>
</html>
